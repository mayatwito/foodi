<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>דיווח עומס</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

<div class="container">
  <h2 class="page-title">📣 דיווח עומס</h2>

  <form method="post" action="/report" class="form-card" autocomplete="off">

    <!-- טלפון -->
    <div class="form-group">
      <label>טלפון:</label>
      <input
        type="text"
        id="phone"
        name="phone"
        inputmode="numeric"
        maxlength="10"
        required
      >
    </div>

    <!-- סוג אוכל – autocomplete -->
    <div class="form-group">
      <label>סוג אוכל:</label>

      <div class="autocomplete-wrapper">
        <input
          type="text"
          name="food_type"
          class="autocomplete-input"
          placeholder="התחיל להקליד או בחר מהרשימה"
          data-items='[
            "איטלקי",
            "אסיאתי",
            "בשרים",
            "המבורגר",
            "מזרחי",
            "חלבי",
            "בר-מסעדה"
          ]'
          required
        >
        <span class="autocomplete-arrow">▾</span>
        <ul class="autocomplete-list"></ul>
      </div>

      <small class="autocomplete-hint">
        ניתן לבחור מהרשימה או להקליד סוג אוכל
      </small>
    </div>

    <!-- זמן המתנה -->
    <div class="form-group">
      <label>זמן המתנה (בדקות):</label>
      <input type="number" name="wait_minutes" min="0" required>
    </div>

    <!-- מקומות פנויים -->
    <div class="form-group">
      <label>מקומות פנויים (אופציונלי):</label>
      <input type="number" name="available_seats" min="0">
    </div>

    <button type="submit">שליחה</button>
  </form>

  <div style="margin-top: 30px; text-align: center;">
    <a href="{{ url_for('home') }}" class="back-btn">
      ⬅ חזרה לדף הבית
    </a>
  </div>
</div>

<!-- ולידציית טלפון -->
<script>
  const phone = document.getElementById("phone");

  phone.addEventListener("input", () => {
    phone.value = phone.value.replace(/[^0-9]/g, "").slice(0, 10);
  });

  phone.addEventListener("paste", (e) => {
    e.preventDefault();
    const text = (e.clipboardData || window.clipboardData).getData("text");
    phone.value = text.replace(/[^0-9]/g, "").slice(0, 10);
  });

  document.querySelector(".form-card").addEventListener("submit", (e) => {
    if (!/^[0-9]{10}$/.test(phone.value)) {
      e.preventDefault();
      phone.focus();
      alert("מספר טלפון לא תקין. יש להזין 10 ספרות בלבד.");
    }
  });
</script>

<!-- Autocomplete (אותו מנגנון כמו מסעדות) -->
<script>
  document.querySelectorAll(".autocomplete-input").forEach(input => {
    const list = input.parentElement.querySelector(".autocomplete-list");
    const items = JSON.parse(input.dataset.items);

    function render(matches) {
      list.innerHTML = "";
      matches.forEach(text => {
        const li = document.createElement("li");
        li.textContent = text;
        li.onclick = () => {
          input.value = text;
          list.style.display = "none";
        };
        list.appendChild(li);
      });
      list.style.display = matches.length ? "block" : "none";
    }

    input.addEventListener("focus", () => render(items));

    input.addEventListener("input", () => {
      const v = input.value.trim();
      render(v ? items.filter(x => x.startsWith(v)) : items);
    });

    document.addEventListener("click", e => {
      if (!input.contains(e.target) && !list.contains(e.target)) {
        list.style.display = "none";
      }
    });
  });
</script>

</body>
</html>
